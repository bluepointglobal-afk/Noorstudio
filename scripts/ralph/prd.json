{
  "project": "NoorStudio",
  "branchName": "ralph/consistent-character-generation",
  "description": "Fix image generation pipeline: prompt→image mapping, 12-pose sheets, character consistency, covers with text, AI-suggested scenes",
  "verifiers": [
    "npx tsc --noEmit"
  ],
  "stories": [
    {
      "id": "US-001",
      "title": "Fix Prompt → Image Mapping",
      "description": "As a user, I want my character's visual DNA (colors, clothing, features) to actually appear in generated images.",
      "acceptanceCriteria": [
        "Audit buildCharacterPrompt() in src/lib/ai/imagePrompts.ts",
        "Document all visual DNA fields and which are missing from prompts",
        "Restructure prompt to include: age, gender, skin tone, hair (color/style/length), eyes, clothing with modesty rules, accessories",
        "Add negative prompt for inappropriate content and style inconsistencies",
        "Generate same character 3x and verify visual DNA is reflected",
        "Typecheck passes"
      ],
      "priority": 1,
      "passes": true,
      "notes": ""
    },
    {
      "id": "US-002",
      "title": "Sequential 12-Pose Generation",
      "description": "As a user, I want to generate a 12-pose reference sheet for my character that works reliably.",
      "acceptanceCriteria": [
        "Identify why single API call for 12 poses fails",
        "Implement sequential pose generation (one at a time)",
        "Use consistent seed across all 12 poses",
        "Create pose-specific prompts for: front_neutral, front_smiling, side_left, side_right, three_quarter, walking, sitting, reading, praying, pointing, thinking, surprised",
        "Update charactersStore.ts pose data structure with url, seed, prompt, generatedAt",
        "Add progress callback for UI updates (0/12 → 12/12)",
        "Typecheck passes"
      ],
      "priority": 2,
      "passes": true,
      "notes": ""
    },
    {
      "id": "US-003",
      "title": "Pose Sheet UI",
      "description": "As a user, I want to see and manage my character's 12-pose reference sheet in the UI.",
      "acceptanceCriteria": [
        "Update CharacterDetailPage.tsx with pose grid (4x3 layout)",
        "Show generation progress indicator",
        "Allow individual pose regeneration",
        "Add 'Regenerate All Poses' button with same seed option",
        "Verify all poses display correctly after generation",
        "Typecheck passes"
      ],
      "priority": 3,
      "passes": true,
      "notes": ""
    },
    {
      "id": "US-004",
      "title": "Character Consistency Strategy",
      "description": "As a developer, I want a strategy for maintaining character consistency across illustrations.",
      "acceptanceCriteria": [
        "Research and document consistency options: reference image, detailed text, seed consistency",
        "Choose and document approach in progress.txt",
        "Create buildScenePrompt() function accepting: sceneDescription, characters (max 2-3), setting, mood, style",
        "Include full visual DNA for each character in scene prompts",
        "Add character positioning hints (left/center/right, relative sizes)",
        "Typecheck passes"
      ],
      "priority": 4,
      "passes": true,
      "notes": ""
    },
    {
      "id": "US-005",
      "title": "Multi-Character Illustration Generation",
      "description": "As a user, I want illustrations with 2-3 characters that all look consistent with their reference sheets.",
      "acceptanceCriteria": [
        "Extract character IDs from scene data",
        "Load character visual DNA for each character in scene",
        "Build composite prompt with all characters",
        "Pass character seeds if API supports",
        "Generate scene with 2 characters and verify both match references",
        "Generate 3 different scenes and verify consistency across all",
        "Typecheck passes"
      ],
      "priority": 5,
      "passes": true,
      "notes": ""
    },
    {
      "id": "US-006",
      "title": "Front Cover Generation",
      "description": "As a user, I want a professional front cover with title and author name.",
      "acceptanceCriteria": [
        "Research children's book cover best practices (title placement, composition)",
        "Create buildFrontCoverPrompt() with: main character, scene hint, space for title/author, Islamic aesthetic elements",
        "Generate base cover image with proper composition",
        "Implement text overlay for title (large, readable font)",
        "Implement text overlay for author name (smaller, elegant font)",
        "Store final composite in cover artifact",
        "Typecheck passes"
      ],
      "priority": 6,
      "passes": true,
      "notes": ""
    },
    {
      "id": "US-007",
      "title": "Back Cover Generation",
      "description": "As a user, I want a professional back cover with synopsis and barcode area.",
      "acceptanceCriteria": [
        "Create buildBackCoverPrompt() with: simpler design, space for synopsis, barcode area",
        "Generate base back cover image",
        "Implement text overlay for synopsis (body text, max width)",
        "Reserve barcode area (bottom right)",
        "Optional: author photo area placeholder",
        "Store final composite in cover artifact",
        "Typecheck passes"
      ],
      "priority": 7,
      "passes": true,
      "notes": ""
    },
    {
      "id": "US-008",
      "title": "Cover UI and Customization",
      "description": "As a user, I want to preview and customize my book covers.",
      "acceptanceCriteria": [
        "Update workspace UI to show front/back cover previews with text",
        "Create CoverTextStyle type with font, size, color, shadow, position options",
        "Allow text style customization (font selection, colors)",
        "Allow text content editing (title, author, synopsis)",
        "Allow individual cover regeneration",
        "Typecheck passes"
      ],
      "priority": 8,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-009",
      "title": "AI Illustration Scene Analysis",
      "description": "As a user, I want AI to suggest 2-3 illustration moments from my chapter content.",
      "acceptanceCriteria": [
        "Define IllustrationSuggestion type with: sceneDescription, charactersInScene, emotionalTone, suggestedComposition, pagePosition, confidence",
        "Create analyzeChapterForIllustrations() function",
        "Implement Claude-based scene analysis with structured output",
        "Create prompt template requesting 2-3 illustration moments per chapter",
        "Parse and return structured suggestions",
        "Typecheck passes"
      ],
      "priority": 9,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-010",
      "title": "Illustration Suggestions UI",
      "description": "As a user, I want to see, accept, and modify AI-suggested illustration scenes.",
      "acceptanceCriteria": [
        "Auto-trigger suggestions after chapter generation",
        "Display suggestions as cards in workspace UI",
        "Add 'Accept' button to queue scene for generation",
        "Add 'Edit' button to modify scene description",
        "Add 'Add Custom' button for manual scenes",
        "Generate illustrations from accepted suggestions",
        "Verify illustrations match suggestion descriptions",
        "Typecheck passes"
      ],
      "priority": 10,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-011",
      "title": "End-to-End Integration Test",
      "description": "As a developer, I want to verify the complete flow works end-to-end.",
      "acceptanceCriteria": [
        "Create new character with full visual DNA",
        "Generate 12-pose reference sheet successfully",
        "Create book project with character",
        "Generate chapter content",
        "Review AI illustration suggestions",
        "Generate illustrations and verify character consistency",
        "Generate front and back covers with text",
        "Verify typecheck, tests, and lint all pass",
        "Update STATUS.md and BACKLOG.md to reflect completion"
      ],
      "priority": 11,
      "passes": false,
      "notes": ""
    }
  ]
}
